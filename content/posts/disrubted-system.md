---
date : '2025-03-23T15:12:50+08:00'
draft : true
title : '分布式系统设计与实践'
tags : ["分布式"]
categories: ["分布式"]
---



## 第六章:分布式服务调用中间件
RPC(Remote Procedure Call) 远程过程调用

### RPC通用问题
RPC的基础是序列化和反序列化，因为一切RPC消息，参数、返回值和异常等都需要被序列化和反序列化之后才能跨节点传递；
业界对其也有非常成熟的方案，比如JSON、XML、Java Object Serialization等序列化方式，但是上面提到的技术各有其
缺点，比如JSON、XML是基于文本的，编码效率低，Java Objet Serialization只限于Java语言

### gRPC
为了解决上面的一些通用的问题，Google 开源的 PB(Protocol Buffers) 则很好的解决了这个问题，Protocol Buffers是在
RPC中常用的一种序列化和反序列化的库，与语言和平台无关

在PB的基础上(PB只是解决了数据的序列化和反序列化问题，要想使用RPC，还得有个框架，以解决消息的发送、解析、路由、线程管理等一系列问题)，
Google 开源出了它的RPC解决方案 gRPC，gRPC的传输使用的是HTTP-2协议，采用HTTP的好处能够支持各种
平台(包括移动端设备)以及各种语言。采用HTTP-2是为了规避前面提到的HTTP-1的一些缺陷，比如队头阻塞和不支持服务器推送等问题
gRPC 目前只支持PB, 因为IDL语言需要采用PB描述的语言

### Thrift
Facebook与Google的情况则不同，Facebook的文化就是用最合适的语言来解决具体的问题，他们面临的问题是不同语言(PHP、Python、C++等)写的大量服务之间的通信问题，因此
Facebook需要的是一个跨语言的解决方案，于是推出了Thrift

### Dubbo
而以阿里为代表的国内互联网公司则更近一步，他们不经需要解决传统RPC问题，还需要对大量的服务进行治理，否则因为舒服数量众多
而且相互间的负载依赖，连架构师自己都弄不清楚某个服务导读依赖了哪些服务，又被多少个服务所依赖，于是有了 Dubbo
Dubbo只支持Java语言，没有专用的IDL语言，直接使用Java接口描述服务

## 第七章:分布式消息服务中间件

### Kafka
在Kafka中传递的消息就是一个键值对
Kafka的Topic中的消息存储在分区中
- kafka将一个Topic中的消息存储在一个或多个分区中，以实现负载均衡
- 每一个分区至少需要两个副本；存储同一分区的多个节点中有一个是领导者，其他的都是追随者；所有的读写操作都是有领导者处理，如果领导者宕机了，就从所有的
追随者里面自动选出一个新的的领导者
- 一个分区的消息是有序的，但同一主题中不同分区中的消息则不保证其次序
- 当生产者发送消息时,kafka会根据一定的策略(轮训或者一个哈希函数)将该消息存储到某个分区中
- 当一个消费者组中有